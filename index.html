<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
  <meta name="theme-color" content="#050505" />
  <title>Galeteria Pais e Filhos | Premium Delivery</title>
  
  <link rel="icon" href="logo.jpeg" type="image/jpeg" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

  <style>
    :root{
      /* --- DESIGN PREMIUM --- */
      --bg: #050505;
      --surface: #18181b;
      --surface-glass: rgba(20, 20, 25, 0.75); 
      --modal-glass: rgba(15, 15, 20, 0.96);
      --text: #ffffff;
      --text-sec: #a1a1aa;
      --border: rgba(255,255,255,0.1);
      
      /* Cores da Marca */
      --brand: #FFC107;        
      --brand-gradient: linear-gradient(135deg, #FFC107 0%, #FF8F00 100%);
      --brand-glow: rgba(255, 193, 7, 0.3);
      
      --success: #10B981;
      --danger: #EF4444;
      --radius: 18px;
      --shadow: 0 10px 30px -10px rgba(0,0,0,0.8);
      --ease: cubic-bezier(0.25, 0.8, 0.25, 1);
    }

    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    
    body {
      margin: 0; font-family: 'Inter', sans-serif;
      background-color: var(--bg); color: var(--text);
      /* Fundo com profundidade */
      background-image: 
        radial-gradient(circle at 100% 0%, rgba(255,193,7,0.06) 0%, transparent 40%),
        radial-gradient(circle at 0% 100%, rgba(255,193,7,0.03) 0%, transparent 40%);
      min-height: 100vh; padding-bottom: 120px; overflow-x: hidden;
      background-attachment: fixed;
    }

    /* Scrollbar */
    ::-webkit-scrollbar { width: 6px; }
    ::-webkit-scrollbar-track { background: var(--bg); }
    ::-webkit-scrollbar-thumb { background: #333; border-radius: 10px; }

    .wrap { max-width: 1000px; margin: 0 auto; padding: 0 20px; }

    /* Anima√ß√µes */
    @keyframes fadeInUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes pulse-green { 0% { box-shadow: 0 0 0 0 rgba(37, 211, 102, 0.7); } 70% { box-shadow: 0 0 0 15px rgba(37, 211, 102, 0); } 100% { box-shadow: 0 0 0 0 rgba(37, 211, 102, 0); } }
    @keyframes float { 0% { transform: translateY(0px) rotateY(-5deg); } 50% { transform: translateY(-10px) rotateY(-5deg); } 100% { transform: translateY(0px) rotateY(-5deg); } }

    .emoji-particle { position: fixed; pointer-events: none; font-size: 24px; z-index: 9999; animation: flyOut 1s forwards cubic-bezier(0.25, 0.46, 0.45, 0.94); }
    @keyframes flyOut { 0% { transform: translate(0, 0) scale(0.5); opacity: 1; } 100% { transform: translate(var(--tx), var(--ty)) scale(1.5) rotate(var(--rot)); opacity: 0; } }
    
    .fire-icon { display: inline-block; animation: firePulse 1.5s infinite ease-in-out; }
    @keyframes firePulse { 0% { transform: scale(1) rotate(0deg); } 50% { transform: scale(1.3) rotate(-5deg); } 100% { transform: scale(1) rotate(0deg); } }

    /* Topbar */
    .topbar {
      position: sticky; top: 0; z-index: 50;
      background: rgba(10, 10, 10, 0.85);
      backdrop-filter: blur(16px); -webkit-backdrop-filter: blur(16px);
      border-bottom: 1px solid var(--border);
      padding: 12px 0; transition: all 0.3s ease; animation: fadeInUp 0.6s ease-out backwards;
    }
    .topbar .wrap { display: flex; align-items: center; justify-content: space-between; }
    
    .brand { display: flex; align-items: center; gap: 14px; cursor: pointer; padding: 5px; border-radius: 12px; transition: background 0.2s; }
    .brand:active { background: rgba(255,255,255,0.05); }
    
    .brand-icon {
      width: 50px; height: 50px; background: transparent; border-radius: 50%;
      display: grid; place-items: center; overflow: hidden;
      box-shadow: 0 0 20px var(--brand-glow); border: 1px solid rgba(255,255,255,0.15);
      transition: transform 0.3s var(--ease); position: relative; z-index: 60;
    }
    .brand:hover .brand-icon { transform: scale(1.05); border-color: var(--brand); }
    .brand-icon img { width: 100%; height: 100%; object-fit: cover; pointer-events: none; }

    .brand-text h1 { font-size: 16px; font-weight: 800; margin: 0; line-height: 1.2; letter-spacing: -0.01em; color: #fff; }
    .brand-text span { font-size: 11px; color: var(--brand); font-weight: 700; text-transform: uppercase; letter-spacing: 0.05em; }

    .status-chip {
      background: rgba(255,255,255,0.05); color: var(--text-sec); border: 1px solid var(--border);
      padding: 6px 12px; border-radius: 100px; font-size: 11px; font-weight: 600;
      display: flex; align-items: center; gap: 8px; white-space: nowrap; transition: all 0.3s ease;
    }
    .status-chip.open { background: rgba(16, 185, 129, 0.15); color: var(--success); border-color: rgba(16, 185, 129, 0.3); }
    .status-chip.closed { background: rgba(239, 68, 68, 0.15); color: var(--danger); border-color: rgba(239, 68, 68, 0.3); }
    .status-dot { width: 6px; height: 6px; background: currentColor; border-radius: 50%; box-shadow: 0 0 8px currentColor; }

    /* Hero */
    .hero { margin-top: 32px; display: grid; grid-template-columns: 1fr 0.8fr; gap: 40px; align-items: center; }
    .hero-content { animation: fadeInUp 0.8s ease-out 0.2s backwards; }
    .hero-content h2 {
      font-size: 40px; line-height: 1.1; font-weight: 800; margin: 0 0 16px; letter-spacing: -0.02em;
      color: #FFC107; 
      text-shadow: 0 0 20px rgba(255, 193, 7, 0.4); 
    }
    .hero-content p { font-size: 16px; color: var(--text-sec); line-height: 1.6; margin: 0 0 24px; max-width: 95%; }
    
    .hero-badges { display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 24px; }
    .badge { padding: 6px 12px; background: rgba(255,255,255,0.05); border-radius: 8px; font-size: 12px; font-weight: 500; color: var(--text-sec); border: 1px solid var(--border); }

    .hours-card {
        background: rgba(255,255,255,0.02); border: 1px solid var(--border); border-radius: var(--radius);
        padding: 16px; margin-bottom: 24px; display: flex; flex-direction: column; gap: 12px;
    }
    .hours-row { display: flex; align-items: flex-start; gap: 12px; }
    .hours-icon { font-size: 18px; padding-top: 2px; }
    .hours-info strong { display: block; color: var(--brand); font-size: 14px; margin-bottom: 2px; }
    .hours-info span { display: block; color: var(--text-sec); font-size: 13px; line-height: 1.4; }

    .btn {
      border: none; outline: none; cursor: pointer; padding: 14px 24px; border-radius: 12px;
      font-weight: 700; font-size: 14px; transition: all 0.2s var(--ease);
      display: inline-flex; align-items: center; justify-content: center; gap: 8px;
    }
    .btn-primary { background: var(--brand-gradient); color: #000; box-shadow: 0 8px 20px -4px var(--brand-glow); }
    .btn-primary:hover { filter: brightness(1.1); transform: translateY(-2px); }
    .btn-primary:active { transform: scale(0.96); }
    .btn-sec { background: rgba(255,255,255,0.05); color: var(--text); border: 1px solid var(--border); }
    .btn-sec:hover { background: rgba(255,255,255,0.1); }

    .hero-visual { position: relative; perspective: 1000px; display: flex; justify-content: center; animation: fadeInUp 0.8s ease-out 0.4s backwards; }
    .promo-frame {
      position: relative; width: 100%; max-width: 320px; border-radius: 24px; padding: 10px;
      background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.08);
      box-shadow: 0 30px 60px -20px rgba(0,0,0,0.8); transform: translateY(0px) rotateY(-5deg); 
      animation: float 6s ease-in-out infinite;
    }
    .promo-frame:hover { animation-play-state: paused; transform: rotateY(0) scale(1.02); }
    .promo-img { width: 100%; display: block; border-radius: 18px; }
    .promo-badge-float {
        position: absolute; top: -10px; right: -10px; background: var(--brand-gradient); color: #000; font-weight: 800;
        padding: 8px 16px; border-radius: 50px; font-size: 13px; box-shadow: 0 10px 20px rgba(0,0,0,0.4); transform: rotate(8deg); z-index: 2;
    }

    /* Menu */
    .section-title { 
      font-size: 22px; font-weight: 700; margin: 50px 0 24px; display: flex; align-items: center; gap: 12px; color: var(--text);
      animation: fadeInUp 0.8s ease-out 0.5s backwards;
    }
    .section-title::after { content:""; height: 1px; flex: 1; background: var(--border); }

    .cat-container {
      position: sticky; top: 75px; z-index: 40; background: rgba(5,5,5,0.8); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); margin: 0 -20px; padding: 10px 20px;
      border-bottom: 1px solid var(--border); animation: fadeInUp 0.8s ease-out 0.7s backwards;
    }
    .search-wrapper { position: relative; margin-bottom: 24px; animation: fadeInUp 0.8s ease-out 0.6s backwards; }
    .search-input {
      width: 100%; background: var(--surface); border: 1px solid var(--border); padding: 14px 14px 14px 48px;
      border-radius: 14px; color: var(--text); font-size: 15px; transition: all 0.2s;
    }
    .search-input:focus { border-color: var(--brand); outline: none; box-shadow: 0 0 0 2px rgba(255,193,7,0.15); }
    .search-icon { position: absolute; left: 18px; top: 50%; transform: translateY(-50%); color: var(--text-sec); opacity: 0.7; }

    .cat-scroll { display: flex; gap: 10px; overflow-x: auto; padding-bottom: 5px; scrollbar-width: none; }
    .cat-scroll::-webkit-scrollbar { display: none; }
    .cat-btn {
      background: var(--surface); border: 1px solid var(--border); color: var(--text-sec);
      padding: 10px 20px; border-radius: 100px; white-space: nowrap; cursor: pointer; font-weight: 600; font-size: 13px; transition: all 0.2s;
    }
    .cat-btn:hover { background: rgba(255,255,255,0.1); color: var(--text); }
    .cat-btn.active { background: var(--text); color: #000; border-color: var(--text); transform: scale(1.05); }

    /* Grid & Cards - EFEITO VIDRO */
    .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; margin-top: 24px; }
    
    .card {
      background: var(--surface-glass); 
      backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
      border: 1px solid var(--border); border-radius: var(--radius); padding: 16px;
      transition: all 0.3s var(--ease); display: flex; flex-direction: column; position: relative; overflow: hidden;
      animation: fadeInUp 0.6s ease-out backwards;
      box-shadow: 0 8px 32px rgba(0,0,0,0.3);
    }
    .card:hover { transform: translateY(-4px); border-color: rgba(255,255,255,0.2); box-shadow: 0 15px 30px rgba(0,0,0,0.5); background: rgba(40, 40, 45, 0.8); }
    
    /* PRODUTO ESGOTADO */
    .card.disabled { opacity: 0.5; pointer-events: none; filter: grayscale(1); }
    .card.disabled::after {
        content: "ESGOTADO"; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%) rotate(-15deg);
        background: rgba(0,0,0,0.8); color: var(--danger); font-weight: 900; padding: 10px 20px; border: 2px solid var(--danger);
        border-radius: 10px; letter-spacing: 2px; font-size: 18px; z-index: 10;
    }

    .card-top { display: flex; gap: 16px; }
    .card-thumb {
      width: 72px; height: 72px; background: #222; border-radius: 14px; flex-shrink: 0;
      display: grid; place-items: center; font-size: 32px; background: radial-gradient(circle at center, #2a2a2a, #151515);
      border: 1px solid rgba(255,255,255,0.05);
    }
    .card-info { flex: 1; }
    .card-title { font-size: 16px; font-weight: 700; margin: 0 0 6px; color: var(--text); }
    .card-rating { font-size: 11px; color: #fbbf24; margin-bottom: 4px; display: flex; align-items: center; gap: 4px; }
    .card-desc { font-size: 13px; color: var(--text-sec); line-height: 1.4; display: -webkit-box; -webkit-line-clamp: 2; line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
    
    .card-price-row { margin-top: 16px; display: flex; justify-content: space-between; align-items: center; }
    .price { font-size: 17px; font-weight: 700; color: var(--brand); }
    
    .add-btn {
      background: rgba(255,255,255,0.05); color: var(--text); width: 34px; height: 34px; border-radius: 10px;
      display: grid; place-items: center; border: 1px solid var(--border); cursor: pointer; transition: 0.2s; font-size: 18px;
    }
    .add-btn:hover { background: var(--text); color: #000; border-color: var(--text); transform: scale(1.1); }
    .add-btn:active { transform: scale(0.9); }

    .qty-controls { display: flex; align-items: center; gap: 10px; background: rgba(255,255,255,0.05); padding: 4px; border-radius: 10px; }
    .qty-btn { width: 26px; height: 26px; border-radius: 8px; border: none; background: #333; color: #fff; cursor: pointer; transition: 0.2s; }
    .qty-btn:hover { background: #444; }
    .qty-val { font-weight: 700; font-size: 14px; min-width: 20px; text-align: center; }

    /* Form & Extras */
    .extras-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 30px; }
    .form-box { background: var(--surface); padding: 20px; border-radius: var(--radius); border: 1px solid var(--border); }
    .form-title { font-size: 15px; font-weight: 700; margin-bottom: 16px; display: flex; gap: 8px; color: var(--text); }
    
    .check-item { display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px dashed rgba(255,255,255,0.1); cursor: pointer; }
    .check-left { display: flex; align-items: center; gap: 12px; }
    .custom-checkbox { width: 20px; height: 20px; border: 2px solid var(--text-sec); border-radius: 6px; display: grid; place-items: center; transition: 0.2s; }
    input[type="checkbox"]:checked + .custom-checkbox { background: var(--brand); border-color: var(--brand); }
    input[type="checkbox"]:checked + .custom-checkbox::after { content:"‚úî"; font-size: 12px; color: #000; font-weight: 900; }
    input[type="checkbox"] { display: none; } 

    textarea {
      width: 100%; background: #111; border: 1px solid var(--border); border-radius: 12px; padding: 14px;
      color: var(--text); font-family: inherit; resize: vertical; min-height: 80px; transition: 0.2s;
    }
    textarea:focus { border-color: var(--brand); outline: none; background: #151515; }

    /* Cart Float */
    .cart-float {
      position: fixed; bottom: 24px; left: 50%; transform: translateX(-50%) translateY(150%);
      width: 90%; max-width: 600px; background: rgba(20, 20, 20, 0.95); backdrop-filter: blur(16px);
      border: 1px solid rgba(255,255,255,0.15); padding: 10px 10px 10px 24px; border-radius: 100px;
      display: flex; justify-content: space-between; align-items: center; box-shadow: 0 20px 50px rgba(0,0,0,0.7);
      z-index: 100; transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }
    .cart-float.show { transform: translateX(-50%) translateY(0); }
    .cart-summ { display: flex; flex-direction: column; }
    .cart-label { font-size: 10px; text-transform: uppercase; letter-spacing: 0.05em; color: var(--text-sec); font-weight: 600; }
    .cart-total { font-size: 16px; font-weight: 800; color: var(--brand); }
    .btn-checkout {
      background: var(--text); color: #000; padding: 12px 24px; border-radius: 100px; font-weight: 700; font-size: 14px;
      border: none; cursor: pointer; box-shadow: 0 4px 15px rgba(255,255,255,0.15); transition: 0.2s;
    }
    .btn-checkout:hover { transform: scale(1.05); background: var(--brand); }

    /* Modals (Comum - Efeito Premium Aplicado) */
    .modal-overlay { 
        position: fixed; inset: 0; background: rgba(0,0,0,0.85); backdrop-filter: blur(8px); 
        z-index: 200; display: none; place-items: center; opacity: 0; transition: opacity 0.3s; 
    }
    .modal-overlay.open { 
        display: flex; 
        opacity: 1; 
    }
    .modal-card {
      width: 95%; max-width: 500px; max-height: 90vh; 
      background: var(--modal-glass); /* Vidro Escuro */
      backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 24px; display: flex; flex-direction: column; transform: translateY(20px) scale(0.95); transition: all 0.3s var(--ease);
      box-shadow: 0 50px 100px -20px rgba(0,0,0,0.9);
    }
    .modal-overlay.open .modal-card { transform: translateY(0) scale(1); }
    .modal-header { padding: 20px 24px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; background: rgba(255,255,255,0.02); }
    .modal-body { padding: 24px; overflow-y: auto; }
    .modal-footer { padding: 20px 24px; border-top: 1px solid var(--border); background: rgba(255,255,255,0.02); border-radius: 0 0 24px 24px; }
    .close-btn { background: rgba(255,255,255,0.05); border: none; width: 32px; height: 32px; border-radius: 50%; color: #fff; cursor: pointer; transition: 0.2s; }
    .close-btn:hover { background: rgba(255,255,255,0.15); }
    .modal-input { width: 100%; background: rgba(0,0,0,0.4); border: 1px solid var(--border); padding: 14px; border-radius: 12px; color: #fff; font-size: 14px; transition: 0.2s; }
    .modal-input:focus { border-color: var(--brand); outline: none; background: rgba(0,0,0,0.6); }
    
    select.modal-input {
      appearance: none; -webkit-appearance: none;
      background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23FFC107' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
      background-repeat: no-repeat; background-position: right 14px center; background-size: 16px;
      padding-right: 40px; cursor: pointer;
    }
    select.modal-input:hover { border-color: rgba(255, 193, 7, 0.5); }

    .input-group { margin-bottom: 16px; }
    .input-group label { display: block; font-size: 12px; color: var(--text-sec); margin-bottom: 6px; font-weight: 600; }

    /* Footer & Float Buttons */
    .site-footer { border-top: 1px solid var(--border); padding: 40px 20px 80px; margin-top: 60px; background: rgba(255,255,255,0.02); text-align: center; }
    .footer-logo img { width: 50px; opacity: 0.8; }
    .dev-watermark { margin-top: 20px; padding-top: 20px; border-top: 1px dashed rgba(255,255,255,0.1); color: rgba(255,255,255,0.3); font-size: 11px; font-weight: 500; letter-spacing: 1px; text-transform: uppercase; }
    .wa-float {
      position: fixed; bottom: 24px; right: 24px; background: #25D366; color: #fff; width: 60px; height: 60px;
      border-radius: 50%; display: grid; place-items: center; box-shadow: 0 4px 12px rgba(37, 211, 102, 0.4);
      z-index: 110; transition: transform 0.3s var(--ease); text-decoration: none; animation: pulse-green 2.5s infinite;
    }
    .wa-float:hover { transform: scale(1.1); }
    .wa-float svg { width: 32px; height: 32px; fill: currentColor; }
    .watermark-float {
      position: fixed; bottom: 10px; left: 14px; z-index: 40; font-size: 10px; color: rgba(255, 255, 255, 0.2);
      font-weight: 700; letter-spacing: 1px; text-transform: uppercase; pointer-events: none; text-shadow: 0 1px 2px rgba(0,0,0,0.8);
    }

    @media (max-width: 768px) {
      .hero { grid-template-columns: 1fr; text-align: center; }
      .grid { grid-template-columns: 1fr; }
      .extras-grid { grid-template-columns: 1fr; }
      .promo-frame { transform: none !important; margin: 0 auto; box-shadow: 0 15px 40px rgba(0,0,0,0.5); }
      .wa-float { bottom: 100px; right: 16px; width: 50px; height: 50px; }
      .wa-float svg { width: 28px; height: 28px; }
    }
  </style>
</head>
<body>

  <!-- Mensagem Toast Otimizada -->
  <div id="toast" style="position:fixed; top:100px; left:50%; transform:translateX(-50%) translateY(-20px); background:#10B981; color:#000; padding:12px 24px; border-radius:50px; font-weight:700; font-size:14px; opacity:0; pointer-events:none; transition:all 0.3s var(--ease); z-index:300; display:flex; gap:8px; box-shadow: 0 10px 20px rgba(0,0,0,0.5);"><span>‚úÖ</span> Item adicionado!</div>

  <div class="topbar">
    <div class="wrap">
      <!-- Atalho para o Admin -->
      <div class="brand" onclick="window.open('admin.html', '_blank')" title="Acesso Admin">
        <div class="brand-icon">
          <img src="logo.jpeg" onerror="this.src='https://placehold.co/50x50/FFC107/000000?text=PF'">
        </div>
        <div class="brand-text">
          <h1>Galeteria Pais e Filhos</h1>
          <span>Premium Delivery</span>
        </div>
      </div>
      <div class="status-chip" id="statusBadge"><div class="status-dot"></div><span id="statusText">...</span></div>
    </div>
  </div>

  <div class="wrap">
    <div class="hero">
      <div class="hero-content">
        <div class="hero-badges">
          <span class="badge"><span class="fire-icon">üî•</span> Promo√ß√£o do Dia</span>
          <span class="badge">üöÄ Entrega R√°pida</span>
        </div>
        
        <div class="hours-card">
          <div class="hours-row">
            <span class="hours-icon">üçó</span>
            <div class="hours-info">
              <strong>Galetos</strong>
              <span id="labelGaletoHours">S√°bados e Domingos: 09h √†s 15h</span>
            </div>
          </div>
        </div>

        <div style="display: flex; gap: 12px; margin-top: 10px;">
          <button class="btn btn-primary" onclick="window.scrollToMenu()">Fazer Pedido</button>
          <button class="btn btn-sec" onclick="window.openCart()">Ver Carrinho</button>
        </div>
      </div>
      <div class="hero-visual">
        <div class="promo-frame">
          <div class="promo-badge-float">OFERTA!</div>
          <img src="PROMO√áOES.jpeg" onerror="this.src='https://placehold.co/320x400/222/eee?text=Foto+Promocao'" class="promo-img">
        </div>
      </div>
    </div>

    <div class="section-title" id="menu">Card√°pio Completo</div>

    <div class="cat-container">
      <div class="search-wrapper">
        <span class="search-icon">üîç</span>
        <input type="text" class="search-input" id="searchInput" placeholder="O que deseja comer hoje?" oninput="window.filterMenu()">
      </div>
      <div class="cat-scroll" id="catScroll"></div>
    </div>

    <div class="grid" id="menuGrid">
        <!-- Produtos carregados do Firebase via JS -->
    </div>

    <div class="extras-grid">
      <div class="form-box" id="extrasBox">
        <div class="form-title"><span>üç¥</span> Prefer√™ncias</div>
        <div id="extrasList">
          <label class="check-item">
            <div class="check-left"><span>üçΩÔ∏è</span> Enviar Talheres</div>
            <input type="checkbox" id="checkTalheres">
            <div class="custom-checkbox"></div>
          </label>
        </div>
      </div>
      <div class="form-box">
        <div class="form-title"><span>üìù</span> Observa√ß√µes</div>
        <textarea id="obsInput" placeholder="Ex: Ponto da carne, sem cebola, troco para 50..."></textarea>
      </div>
    </div>
  </div>

  <footer class="site-footer">
    <div class="footer-content">
      <div class="footer-logo">
        <img src="logo.jpeg" onerror="this.style.display='none'" style="width: 60px; height: 60px; border-radius: 50%; opacity: 0.7; filter: grayscale(1);">
      </div>
      <div class="footer-info">
        <p><strong>Galeteria Pais e Filhos</strong></p>
        <p>O melhor sabor da regi√£o entregue na sua casa.</p>
        <p style="margin-top: 10px;">üìç Atendemos Bairros Pr√≥ximos e Centro</p>
        <p>üìû (79) 98810-0417</p>
      </div>
      <div class="dev-watermark">Desenvolvido por <strong>Ferreira Web Design</strong></div>
    </div>
  </footer>

  <a href="https://api.whatsapp.com/message/7FGXL4XM42QXL1?autoload=1&app_absent=0" target="_blank" class="wa-float" aria-label="Fale connosco no WhatsApp">
    <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12.004 2c-5.514 0-10 4.486-10 10 0 1.83.496 3.567 1.373 5.09l-1.377 4.91 5.059-1.33c1.455.79 3.102 1.23 4.945 1.23 5.514 0 10-4.486 10-10s-4.486-10-10-10zm0 18.003c-1.63 0-3.125-.436-4.437-1.185l-.326-.186-2.89.76.78-2.81-.197-.332c-.84-1.423-1.33-3.08-1.33-4.85 0-4.41 3.59-8.003 8.004-8.003s8.004 3.593 8.004 8.003-3.59 8.003-8.004 8.003zm4.553-6.22c-.25-.125-1.485-.733-1.715-.817-.23-.083-.397-.125-.565.125-.168.25-.652.817-.8.984-.148.167-.298.188-.548.063-.25-.125-1.055-.39-2.01-1.24-.74-.66-1.24-1.472-1.387-1.722-.148-.25-.016-.386.11-.51.112-.112.25-.292.373-.438.125-.146.167-.25.25-.417.084-.167.042-.313-.02-.438-.063-.125-.565-1.363-.774-1.867-.203-.49-.41-.423-.565-.43-.148-.008-.317-.008-.485-.008-.168 0-.44.063-.672.313-.23.25-.882.862-.882 2.104 0 1.242.903 2.442 1.03 2.61.125.166 1.777 2.713 4.305 3.804 1.678.724 2.016.58 2.377.544.36-.037 1.148-.47 1.31-0.922.164-.452.164-.84.115-.922-.05-.084-.183-.125-.433-.25z"/></svg>
  </a>

  <div class="watermark-float">Ferreira Web Design</div>

  <!-- Cart Float -->
  <div class="cart-float" id="cartFloat">
    <div class="cart-summ">
      <span class="cart-label">Total do Pedido</span>
      <span class="cart-total" id="floatTotal">R$ 0,00</span>
    </div>
    <div style="display:flex; gap:12px; align-items:center;">
       <button class="add-btn" style="background:transparent; border:none; color: #aaa; font-size:14px;" onclick="window.clearCart()">Limpar</button>
       <button class="btn-checkout" onclick="window.openCart()">Concluir ‚ûî</button>
    </div>
  </div>

  <!-- Modal Checkout -->
  <div class="modal-overlay" id="cartModal">
    <div class="modal-card">
      <div class="modal-header">
        <h3 style="margin:0; font-weight: 700; color: #fff;">Seu Carrinho</h3>
        <button class="close-btn" onclick="window.closeCart()">‚úï</button>
      </div>
      <div class="modal-body">
        <div id="cartItemsList"></div>
        <div style="margin-top: 24px; border-top: 1px solid var(--border); padding-top: 20px;">
           <div style="display:flex; justify-content:space-between; margin-bottom:10px; color:var(--text-sec); font-size:14px;">
             <span>Subtotal</span>
             <span id="modalSubtotal">R$ 0,00</span>
           </div>
           <div style="display:flex; justify-content:space-between; margin-bottom:10px; color:var(--text-sec); font-size:14px;">
             <span>Taxa de Entrega</span>
             <span id="modalExtras">Gr√°tis</span>
           </div>
           
           <!-- Bot√µes de M√©todo de Entrega -->
           <div style="display:flex; gap:10px; margin-bottom: 16px;">
             <button type="button" id="btnDelivery" class="btn btn-primary" style="flex:1; padding:10px;" onclick="window.setDeliveryMethod('entrega')">üõµ Entrega</button>
             <button type="button" id="btnPickup" class="btn btn-sec" style="flex:1; padding:10px;" onclick="window.setDeliveryMethod('retirada')">üè™ Retirada</button>
           </div>

           <div style="display:flex; justify-content:space-between; font-size:20px; font-weight:800; color:var(--brand); border-top: 1px dashed rgba(255,255,255,0.1); padding-top: 15px;">
             <span>Total</span>
             <span id="modalTotal">R$ 0,00</span>
           </div>
        </div>

        <h4 style="margin: 24px 0 16px; font-size: 14px; text-transform: uppercase; color: var(--text-sec); letter-spacing: 0.05em; border-bottom: 1px solid var(--border); padding-bottom: 8px;">Seus Dados</h4>
        
        <div class="input-group"><label>Nome Completo</label><input type="text" id="clientName" class="modal-input" placeholder="Seu nome"></div>
        <div class="input-group"><label>Telefone</label><input type="tel" id="clientPhone" class="modal-input" placeholder="(XX) XXXXX-XXXX" maxlength="15"></div>
        
        <div id="deliveryFields">
            <div class="input-group">
              <label>Bairro da Entrega <span style="color: var(--brand); font-size: 10px; font-weight: 700; margin-left: 4px; letter-spacing: 0;">(Toque para alterar üëá)</span></label>
              <select id="deliverySelect" class="modal-input" onchange="window.updateTotals()">
                <!-- Preenchido via JS -->
              </select>
            </div>
            <div class="input-group" id="addressGroup">
              <label>Endere√ßo Completo</label>
              <input type="text" id="clientAddress" class="modal-input" placeholder="Rua, N√∫mero, Ponto de Refer√™ncia...">
            </div>
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
          <div class="input-group"><label>Pagamento</label><select id="paymentMethod" class="modal-input" onchange="window.togglePay()"><option value="Pix">Pix</option><option value="Cart√£o">Cart√£o</option><option value="Dinheiro">Dinheiro</option></select></div>
          <div class="input-group" id="changeGroup" style="display:none;"><label>Troco para</label><input type="tel" id="payChange" class="modal-input" placeholder="R$ 0,00"></div>
        </div>

        <div id="pixGroup" style="margin-top: -8px; margin-bottom: 16px; background: rgba(255,193,7,0.1); padding: 12px; border-radius: 12px; border: 1px dashed var(--brand);">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                <span style="font-size: 11px; color: var(--brand); font-weight: 700; letter-spacing: 0.05em;">CHAVE PIX</span>
                <button onclick="window.copyPix()" style="background: var(--brand); border: none; border-radius: 6px; padding: 6px 12px; font-weight: 700; cursor: pointer; font-size: 11px; color: #000; box-shadow: 0 2px 5px rgba(0,0,0,0.2);">COPIAR</button>
            </div>
            <input type="text" value="79998773002" readonly style="width:100%; background: rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.1); color: #fff; font-family: monospace; font-size: 15px; padding: 10px; border-radius: 8px; text-align: center; margin-bottom: 8px; outline: none;" id="pixKeyInput" onclick="this.select();">
            <div style="text-align: center; font-size: 11px; color: #aaa; line-height: 1.4;">
                Titular: <strong id="pixNameDisplay" style="color: #fff;">Gabriel Santana Morais</strong><br>
                <span id="pixBankDisplay" style="font-size: 10px; opacity: 0.8;">Banco do Brasil</span>
            </div>
        </div>

      </div>
      <div class="modal-footer">
        <button class="btn btn-primary" style="width:100%; justify-content: center; height: 50px;" onclick="window.sendOrder(event)">Enviar Pedido no WhatsApp</button>
      </div>
    </div>
  </div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
  import { getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
  import { getFirestore, doc, onSnapshot, addDoc, collection, getDocs } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

  // CONFIGURA√á√ÉO DO FIREBASE
  let firebaseConfig;
  let appId = 'galeteria-pais-filhos';
  
  if (typeof __firebase_config !== 'undefined') {
    firebaseConfig = JSON.parse(__firebase_config);
    if (typeof __app_id !== 'undefined') appId = __app_id;
  } else {
    firebaseConfig = { 
        apiKey: "AIzaSyCzekvqmEji0fqfXrhPIQFr-xELAU8EmTs", 
        authDomain: "galeto-1dc17.firebaseapp.com", 
        projectId: "galeto-1dc17", 
        storageBucket: "galeto-1dc17.firebasestorage.app", 
        messagingSenderId: "777086839092", 
        appId: "1:777086839092:web:042261c5ce1f152a4c9d61" 
    };
  }
  
  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);
  const WHATSAPP = "5579988100417";
  const APPS_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyXPG30IQSfBWDxaHh_7m5Z_ZYnuFcoWNqzv-WqePbtBjSPQkh3Y5wyEgwOpcDbALkqkw/exec"; 

  // M√ÅSCARA AUTOM√ÅTICA DE TELEFONE (UX Melhoarada)
  const phoneInput = document.getElementById('clientPhone');
  if (phoneInput) {
      phoneInput.addEventListener('input', function (e) {
          let x = e.target.value.replace(/\D/g, ''); // Remove tudo que n√£o for n√∫mero
          if (x.length === 0) { e.target.value = ''; return; }
          if (x.length <= 2) { e.target.value = '(' + x; return; }
          if (x.length <= 7) { e.target.value = '(' + x.substring(0,2) + ') ' + x.substring(2); return; }
          e.target.value = '(' + x.substring(0,2) + ') ' + x.substring(2,7) + '-' + x.substring(7,11);
      });
  }

  const categories = [
    { id: "todos", label: "Todos" },
    { id: "combos", label: "Combos" },
    { id: "porcoes", label: "Por√ß√µes" },
    { id: "bebidas", label: "Bebidas" }
  ];

  // FALLBACK: Lista de seguran√ßa
  const defaultZones = [
      { name: "Albano Franco", price: 2.00 },
      { name: "Marcos Freire 1", price: 3.00 },
      { name: "Marcos Freire 3", price: 3.00 },
      { name: "Tai√ßoca de Dentro", price: 3.00 },
      { name: "Sede de Socorro", price: 10.00 }
  ];

  let appConfig = { 
      isOpenManually: false, 
      isClosedManually: false, 
      deliveryZones: [], 
      hours: { galeto: { start: 9, end: 15 } }, 
      pix: {}
  };
  
  let products = [];
  let cart = {}; 
  window.activeCat = 'todos';

  // --- INIT AUTH ---
  const initAuth = async () => {
    if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
      await signInWithCustomToken(auth, __initial_auth_token);
    } else {
      await signInAnonymously(auth);
    }
  };
  initAuth();
  
  onAuthStateChanged(auth, (u) => { 
      if(u) {
          subscribeToConfig(); 
          subscribeToProducts();
      }
  });

  // --- FUN√á√ïES APP CLIENTE ---
  window.deliveryMethod = 'entrega';

  window.setDeliveryMethod = (method) => {
      window.deliveryMethod = method;
      const btnDel = document.getElementById('btnDelivery');
      const btnPic = document.getElementById('btnPickup');
      const fields = document.getElementById('deliveryFields');
      
      if(method === 'entrega') {
          btnDel.className = 'btn btn-primary';
          btnPic.className = 'btn btn-sec';
          fields.style.display = 'block';
      } else {
          btnDel.className = 'btn btn-sec';
          btnPic.className = 'btn btn-primary';
          fields.style.display = 'none';
      }
      window.updateTotals();
  };

  window.add = (id, e) => {
      cart[id] = (cart[id]||0)+1; 
      renderCartFloat();
      if(e) {
          const emojis = ['üçó','üçü','ü•§','üòã'];
          for(let i=0;i<8;i++){
              const el = document.createElement('div');
              el.className = 'emoji-particle';
              el.innerText = emojis[Math.floor(Math.random()*emojis.length)];
              el.style.left=e.clientX+'px'; el.style.top=e.clientY+'px';
              const angle = Math.random() * Math.PI * 2;
              const velocity = 60 + Math.random() * 80;
              el.style.setProperty('--tx', Math.cos(angle) * velocity + 'px');
              el.style.setProperty('--ty', Math.sin(angle) * velocity + 'px');
              el.style.setProperty('--rot', (Math.random() * 360 - 180) + 'deg');
              document.body.appendChild(el); setTimeout(()=>el.remove(),1000);
          }
      }
      showToast();
  };
  window.rem = (id) => { if(cart[id]>0) cart[id]--; if(cart[id]===0) delete cart[id]; renderCartFloat(); renderCartModal(); };
  window.clearCart = () => { cart = {}; renderCartFloat(); if(document.getElementById('cartModal').classList.contains('open')) renderCartModal(); };
  window.openCart = () => { renderCartModal(); document.getElementById('cartModal').classList.add('open'); };
  window.closeModal = () => { document.getElementById('cartModal').classList.remove('open'); };
  window.closeCart = () => { document.getElementById('cartModal').classList.remove('open'); };
  window.scrollToMenu = () => document.getElementById('menu').scrollIntoView({behavior:'smooth'});
  window.togglePay = () => { 
      const method = document.getElementById('paymentMethod').value;
      const group = document.getElementById('changeGroup');
      if(group) group.style.display = method === 'Dinheiro' ? 'block' : 'none';
      
      const pixGroup = document.getElementById('pixGroup');
      if(pixGroup) pixGroup.style.display = method === 'Pix' ? 'block' : 'none';
  };
  window.copyPix = () => { document.getElementById('pixKeyInput').select(); document.execCommand('copy'); alert("Chave Copiada!"); };

  window.updateTotals = () => { renderCartModal(); };
  window.filterMenu = () => { renderMenu(); };

  // --- INTERNOS ---
  function formatMoney(v) { return "R$ " + parseFloat(v||0).toFixed(2).replace('.', ','); }
  
  let toastTimeout;
  function showToast(msg) { 
      const t = document.getElementById('toast'); 
      if(msg) t.innerHTML = msg; 
      
      t.style.opacity = 1; 
      t.style.transform = 'translateX(-50%) translateY(0)'; // Efeito de descida
      
      clearTimeout(toastTimeout);
      toastTimeout = setTimeout(() => { 
          t.style.opacity = 0; 
          t.style.transform = 'translateX(-50%) translateY(-20px)';
          setTimeout(() => { if(!msg) t.innerHTML = '<span>‚úÖ</span> Item adicionado!'; }, 300); 
      }, 2000); 
  }

  function renderCartFloat() {
      let total = 0; 
      for(let id in cart) {
          const p = products.find(x => x.id === id);
          if(p) total += (p.price * cart[id]);
      }
      document.getElementById('floatTotal').innerText = formatMoney(total);
      
      const cartFloat = document.getElementById('cartFloat');
      if(total > 0) {
          cartFloat.classList.add('show');
      } else {
          cartFloat.classList.remove('show');
          window.closeCart(); // Fecha o modal caso ele esvazie totalmente por dentro do carrinho
      }
  }
  
  function renderCartModal() {
      const list = document.getElementById('cartItemsList');
      if(!list) return;
      list.innerHTML = "";
      let totalProd = 0;
      for(let id in cart) {
          const p = products.find(x => x.id === id);
          if(p) {
              totalProd += p.price * cart[id];
              list.innerHTML += `<div style="display:flex; justify-content:space-between; margin-bottom:10px; border-bottom:1px solid #222; padding-bottom:10px;"><div>${cart[id]}x ${p.name}</div><div style="font-weight:700;">${formatMoney(p.price*cart[id])}</div><div class="qty-controls"><button class="qty-btn" onclick="window.rem('${id}')">-</button><button class="qty-btn" onclick="window.add('${id}', event)">+</button></div></div>`;
          }
      }
      
      const sel = document.getElementById('deliverySelect');
      let delPrice = 0;

      if (sel) {
          const zones = Array.isArray(appConfig.deliveryZones) && appConfig.deliveryZones.length > 0 ? appConfig.deliveryZones : defaultZones;
          const currentVal = sel.value;
          
          sel.innerHTML = zones.map((z, i) => `<option value="${i}">${z.name} (${formatMoney(z.price)})</option>`).join('');
          
          if(currentVal && currentVal !== "") sel.value = currentVal;

          const selectedZone = zones[sel.value] || zones[0];
          delPrice = window.deliveryMethod === 'retirada' ? 0 : (selectedZone ? parseFloat(selectedZone.price) : 0);
      }
      
      document.getElementById('modalSubtotal').innerText = formatMoney(totalProd);
      document.getElementById('modalExtras').innerText = delPrice > 0 ? formatMoney(delPrice) : 'Gr√°tis';
      document.getElementById('modalTotal').innerText = formatMoney(totalProd + delPrice);
  }

  function checkOpenStatus() {
    const now = new Date(); const day = now.getDay(); const hour = now.getHours();
    const isWeekend = (day === 0 || day === 6);
    const isTime = (hour >= appConfig.hours.galeto.start && hour < appConfig.hours.galeto.end);
    if (appConfig.isClosedManually) return false; if (appConfig.isOpenManually) return true;
    return isWeekend && isTime;
  }
  
  function updatePixUI() {
      if(appConfig.pix) {
          const keyInput = document.getElementById('pixKeyInput'); if(keyInput) keyInput.value = appConfig.pix.key || "";
          const nameDisplay = document.getElementById('pixNameDisplay'); if(nameDisplay) nameDisplay.innerText = appConfig.pix.name || "Nome Titular";
          const bankDisplay = document.getElementById('pixBankDisplay'); if(bankDisplay) bankDisplay.innerText = appConfig.pix.bank || "Banco";
      }
  }

  // FIREBASE: ESCUTAR CONFIGURA√á√ïES
  function subscribeToConfig() {
    onSnapshot(doc(db, 'artifacts', appId, 'public', 'data', 'config', 'store_settings'), (s) => {
      if (s.exists()) {
        appConfig = { ...appConfig, ...s.data() }; 
        const isOpen = checkOpenStatus(); const badge = document.getElementById('statusBadge'); const txt = document.getElementById('statusText');
        if(isOpen) { badge.className='status-chip open'; txt.innerText="Aberto"; } else { badge.className='status-chip closed'; txt.innerText="Fechado"; }
        updatePixUI();
        if(document.getElementById('cartModal').classList.contains('open')) renderCartModal();
      }
    });
  }

  // FIREBASE: ESCUTAR PRODUTOS E PREVENIR BUGS DE CARRINHO FANTASMA
  function subscribeToProducts() {
      onSnapshot(collection(db, 'artifacts', appId, 'public', 'data', 'products'), (snap) => {
          products = [];
          snap.forEach(doc => {
              products.push({ id: doc.id, ...doc.data() });
          });
          products.sort((a,b) => (a.cat || '').localeCompare(b.cat || '') || (a.name || '').localeCompare(b.name || ''));
          
          // Limpeza: Se o Admin apagar um produto no Firebase, remove do carrinho de quem estiver no site
          let cartChanged = false;
          for(let id in cart) {
              if(!products.find(x => x.id === id)) {
                  delete cart[id];
                  cartChanged = true;
              }
          }
          
          renderMenu();
          if(cartChanged) renderCartFloat();
          if(document.getElementById('cartModal').classList.contains('open')) renderCartModal();
      }, (error) => {
          console.error("Erro ao carregar card√°pio:", error);
      });
  }

  function renderMenu() {
      const grid = document.getElementById('menuGrid'); if (!grid) return;
      const searchInput = document.getElementById('searchInput'); const search = searchInput ? searchInput.value.toLowerCase() : '';
      
      const filtered = products.filter(p => { 
          const matchCat = p.cat === (window.activeCat || 'todos') || window.activeCat === 'todos'; 
          return matchCat && (p.name || '').toLowerCase().includes(search); 
      });
      
      grid.innerHTML = filtered.map(p => `
        <div class="card ${p.inStock === false ? 'disabled' : ''}">
            <div class="card-top">
                <div class="card-thumb">${p.img || 'üçó'}</div>
                <div>
                    <div class="card-title">${p.name}</div>
                    <div class="card-desc">${p.desc}</div>
                </div>
            </div>
            <div class="card-price-row">
                <div class="price">${formatMoney(p.price)}</div>
                <button class="add-btn" onclick="window.add('${p.id}', event)">+</button>
            </div>
        </div>
      `).join('');
  }

  // --- SEND ORDER ---
  window.sendOrder = async (e) => {
      if(Object.keys(cart).length === 0) {
          alert("O seu carrinho est√° vazio! Adicione algum produto antes de finalizar.");
          return;
      }

      try {
          const isOpen = checkOpenStatus();
          if(!isOpen) { alert("üîí LOJA FECHADA\nEstamos fechados no momento. Hor√°rio: S√°b e Dom (09h-15h)."); return; }
          
          let btn = e ? e.target : null;
          if(btn) { btn.innerText = "A enviar..."; btn.disabled = true; }

          const name = document.getElementById('clientName').value.trim();
          const phone = document.getElementById('clientPhone').value;
          const address = document.getElementById('clientAddress') ? document.getElementById('clientAddress').value.trim() : '';
          const pay = document.getElementById('paymentMethod').value;
          const change = document.getElementById('payChange') ? document.getElementById('payChange').value : '';
          const deliveryEl = document.getElementById('deliverySelect');
          
          let isDelivery = window.deliveryMethod === 'entrega';
          let delPrice = 0;
          let delText = "Retirada na Loja";
          
          if(isDelivery && deliveryEl && deliveryEl.options.length > 0 && deliveryEl.selectedIndex >= 0) {
              const zones = Array.isArray(appConfig.deliveryZones) && appConfig.deliveryZones.length > 0 ? appConfig.deliveryZones : defaultZones;
              const selectedZone = zones[deliveryEl.value];
              if(selectedZone) {
                  delPrice = parseFloat(selectedZone.price);
                  delText = selectedZone.name;
              }
          }

          let obs = document.getElementById('obsInput') ? document.getElementById('obsInput').value : '';
          const querTalheres = document.getElementById('checkTalheres') && document.getElementById('checkTalheres').checked;
          if (querTalheres) {
              obs = (obs ? obs + " | " : "") + "Enviar Talheres Descart√°veis";
          }

          if(!name || name.length < 2) { 
              alert("Por favor, preencha o seu Nome Completo."); 
              if(btn) { btn.disabled=false; btn.innerText="Enviar Pedido no WhatsApp"; }
              return; 
          }
          if(isDelivery && (!address || address.length < 5)) {
              alert("Por favor, preencha o seu Endere√ßo Completo para a entrega."); 
              if(btn) { btn.disabled=false; btn.innerText="Enviar Pedido no WhatsApp"; }
              return; 
          }

          let nextNum = 1;
          try {
              const snap = await getDocs(collection(db, 'artifacts', appId, 'public', 'data', 'orders'));
              let maxNum = 0;
              snap.forEach(d => {
                  const o = d.data();
                  if (o.numero) {
                      let n = parseInt(o.numero, 10);
                      if (!isNaN(n) && n > maxNum) maxNum = n;
                  }
              });
              if(maxNum > 0) nextNum = maxNum + 1;
          } catch(err) {
              console.log("Erro ao buscar ultimo n√∫mero, usando fallback", err);
              nextNum = parseInt(localStorage.getItem('orderNum') || 0, 10) + 1;
          }
          
          localStorage.setItem('orderNum', nextNum); 
          let orderNum = String(nextNum).padStart(2, '0'); 

          let itemsList = ""; let totalProd = 0;
          for(let id in cart) { 
              const p = products.find(x => x.id === id); 
              if(p) { totalProd += p.price * cart[id]; itemsList += `${cart[id]}x ${p.name}\n`; }
          }
          itemsList = itemsList.trim();
          const total = totalProd + delPrice;
          let payTxt = `${pay} ${formatMoney(total)}`;
          if(pay==='Dinheiro' && change) payTxt += ` (Troco: ${change})`;

          let addressStr = "";
          if (isDelivery) {
              addressStr = `${address}, ${delText} - Entrega`;
          } else {
              addressStr = address ? `${address} - Retirada` : `Retirada`;
          }

          let msg = `PEDIDO ${orderNum}\n\n${itemsList}\n\n${addressStr}\n\n${payTxt}\n\n${name} - ${phone}`;
          if(obs) msg += `\n\nObs: ${obs}`;

          const orderData = { 
              numero: orderNum, 
              data: new Date().toLocaleString('pt-BR'), 
              cliente: name, 
              telefone: phone, 
              valor: total, 
              pagamento: payTxt, 
              endereco: isDelivery ? address : 'Retirada', 
              bairro: delText, 
              detalhes: itemsList.replace(/\n/g, ', '), 
              entrega: delPrice,
              status: 'pendente' // Novo status inicial
          };
          
          addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'orders'), { ...orderData, timestamp: new Date() });
          fetch(APPS_SCRIPT_URL, { method: 'POST', mode: 'no-cors', headers: {'Content-Type': 'application/json'}, body: JSON.stringify(orderData) });

          setTimeout(() => { 
              if(btn) { btn.innerText = "Enviar Pedido no WhatsApp"; btn.disabled = false; }
              window.closeModal(); cart={}; renderCartFloat(); 
              
              const waLink = `https://wa.me/${WHATSAPP}?text=${encodeURIComponent(msg)}`;
              window.location.href = waLink;
          }, 100);

      } catch (err) {
          console.error(err); alert("Erro ao enviar. Tente novamente.");
          if(e && e.target) { e.target.disabled = false; e.target.innerText = "Enviar Pedido no WhatsApp"; }
      }
  };

  document.querySelector('.cat-container').innerHTML = categories.map(c=>`<button class="cat-btn ${c.id==='todos'?'active':''}" onclick="window.setCat('${c.id}')">${c.label}</button>`).join('');
  window.setCat = (c) => { window.activeCat = c; renderMenu(); document.querySelectorAll('.cat-btn').forEach(b => b.classList.toggle('active', b.innerText === categories.find(cat=>cat.id===c).label)); };

</script>
</body>
</html>
