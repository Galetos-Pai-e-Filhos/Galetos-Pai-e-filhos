<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
  <meta name="theme-color" content="#050505" />
  <title>Galeteria Pais e Filhos | Premium Delivery</title>
  <meta name="description" content="O melhor galeto da cidade. Pe√ßa online." />

  <link rel="icon" href="logo.jpeg" type="image/jpeg" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

  <style>
    :root{
      var(--bg): #0a0a0a;
      --surface: #18181b;
      --surface-glass: rgba(30, 30, 35, 0.7);
      --text: #ffffff;
      --text-sec: #a1a1aa;
      --border: rgba(255,255,255,0.08);
      --brand: #FFC107;        
      --brand-gradient: linear-gradient(135deg, #FFC107 0%, #FF8F00 100%);
      --brand-glow: rgba(255, 193, 7, 0.25);
      --success: #10B981;
      --danger: #EF4444;
      --radius: 16px;
      --shadow: 0 10px 30px -10px rgba(0,0,0,0.6);
      --ease: cubic-bezier(0.25, 0.8, 0.25, 1);
    }

    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    
    body {
      margin: 0;
      font-family: 'Inter', system-ui, -apple-system, sans-serif;
      background-color: #0a0a0a;
      color: #ffffff;
      background-image: 
        radial-gradient(circle at 100% 0%, rgba(255,193,7,0.06) 0%, transparent 40%),
        radial-gradient(circle at 0% 100%, rgba(255,193,7,0.03) 0%, transparent 40%);
      min-height: 100vh;
      padding-bottom: 100px;
      overflow-x: hidden;
    }

    /* Scrollbar */
    ::-webkit-scrollbar { width: 6px; }
    ::-webkit-scrollbar-track { background: #0a0a0a; }
    ::-webkit-scrollbar-thumb { background: #333; border-radius: 10px; }

    .wrap { max-width: 1000px; margin: 0 auto; padding: 0 20px; }

    /* --- ANIMA√á√ïES --- */
    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(30px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes pulse-green {
      0% { box-shadow: 0 0 0 0 rgba(37, 211, 102, 0.7); }
      70% { box-shadow: 0 0 0 15px rgba(37, 211, 102, 0); }
      100% { box-shadow: 0 0 0 0 rgba(37, 211, 102, 0); }
    }

    @keyframes firePulse {
      0% { transform: scale(1) rotate(0deg); filter: drop-shadow(0 0 0 rgba(255, 100, 0, 0)); }
      50% { transform: scale(1.3) rotate(-5deg); filter: drop-shadow(0 0 8px rgba(255, 69, 0, 0.8)); }
      100% { transform: scale(1) rotate(0deg); filter: drop-shadow(0 0 0 rgba(255, 100, 0, 0)); }
    }
    .fire-icon { display: inline-block; animation: firePulse 1.5s infinite ease-in-out; }

    /* Anima√ß√£o de Explos√£o de Emojis */
    .emoji-particle {
      position: fixed; pointer-events: none; font-size: 24px; z-index: 9999;
      animation: flyOut 1s forwards cubic-bezier(0.25, 0.46, 0.45, 0.94);
    }
    @keyframes flyOut {
      0% { transform: translate(0, 0) scale(0.5); opacity: 1; }
      100% { transform: translate(var(--tx), var(--ty)) scale(1.5) rotate(var(--rot)); opacity: 0; }
    }

    /* --- TOPBAR --- */
    .topbar {
      position: sticky; top: 0; z-index: 50;
      background: rgba(10, 10, 10, 0.85);
      backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
      border-bottom: 1px solid rgba(255,255,255,0.08);
      padding: 12px 0;
      transition: all 0.3s ease;
      animation: fadeInUp 0.6s ease-out backwards;
    }
    .topbar .wrap { display: flex; align-items: center; justify-content: space-between; }
    
    .brand { display: flex; align-items: center; gap: 14px; }
    
    .brand-icon {
      width: 50px; height: 50px; background: transparent; border-radius: 50%;
      display: grid; place-items: center; overflow: hidden;
      box-shadow: 0 0 15px rgba(255, 193, 7, 0.25);
      border: 1px solid rgba(255,255,255,0.1);
      position: relative; z-index: 60;
    }
    .brand-icon img { width: 100%; height: 100%; object-fit: cover; pointer-events: none; }

    .brand-text h1 { font-size: 16px; font-weight: 700; margin: 0; line-height: 1.2; letter-spacing: -0.01em; color: #fff; }
    .brand-text span { font-size: 11px; color: #FFC107; font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em; }

    .status-chip {
      background: rgba(255,255,255,0.03); color: #a1a1aa; border: 1px solid rgba(255,255,255,0.08);
      padding: 6px 12px; border-radius: 100px; font-size: 11px; font-weight: 600;
      display: flex; align-items: center; gap: 8px; white-space: nowrap;
    }
    .status-chip.open { background: rgba(16, 185, 129, 0.1); color: #10B981; border-color: rgba(16, 185, 129, 0.2); }
    .status-chip.closed { background: rgba(239, 68, 68, 0.1); color: #EF4444; border-color: rgba(239, 68, 68, 0.2); }
    .status-dot { width: 6px; height: 6px; background: currentColor; border-radius: 50%; box-shadow: 0 0 8px currentColor; }

    /* --- HERO --- */
    .hero { margin-top: 32px; display: grid; grid-template-columns: 1fr 0.8fr; gap: 40px; align-items: center; }
    .hero-content { animation: fadeInUp 0.8s ease-out 0.2s backwards; }
    .hero-content h2 {
      font-size: 40px; line-height: 1.1; font-weight: 800; margin: 0 0 16px; letter-spacing: -0.02em;
      background: linear-gradient(to right, #fff, #ccc); -webkit-background-clip: text; color: transparent;
    }
    .hero-content p { font-size: 16px; color: #a1a1aa; line-height: 1.6; margin: 0 0 24px; max-width: 95%; }
    
    .hero-badges { display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 24px; }
    .badge {
      padding: 6px 12px; background: rgba(255,255,255,0.05); border-radius: 8px;
      font-size: 12px; font-weight: 500; color: #a1a1aa; border: 1px solid rgba(255,255,255,0.08);
    }

    .hours-card {
        background: rgba(255,255,255,0.02); border: 1px solid rgba(255,255,255,0.08);
        border-radius: 16px; padding: 16px; margin-bottom: 24px; display: flex; flex-direction: column; gap: 12px;
    }
    .hours-row { display: flex; align-items: flex-start; gap: 12px; }
    .hours-icon { font-size: 18px; padding-top: 2px; }
    .hours-info strong { display: block; color: #FFC107; font-size: 14px; margin-bottom: 2px; }
    .hours-info span { display: block; color: #a1a1aa; font-size: 13px; line-height: 1.4; }

    .btn {
      border: none; outline: none; cursor: pointer; padding: 14px 24px; border-radius: 12px;
      font-weight: 700; font-size: 14px; transition: all 0.2s; display: inline-flex; align-items: center; justify-content: center; gap: 8px;
    }
    .btn-primary {
      background: linear-gradient(135deg, #FFC107 0%, #FF8F00 100%); color: #000;
      box-shadow: 0 8px 20px -4px rgba(255, 193, 7, 0.25);
    }
    .btn-primary:hover { filter: brightness(1.1); transform: translateY(-2px); }
    .btn-sec { background: rgba(255,255,255,0.05); color: #fff; border: 1px solid rgba(255,255,255,0.08); }

    .hero-visual { 
      position: relative; perspective: 1000px; display: flex; justify-content: center; 
      animation: fadeInUp 0.8s ease-out 0.4s backwards;
    }
    .promo-frame {
      position: relative; width: 100%; max-width: 320px; border-radius: 24px; padding: 10px;
      background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.08);
      box-shadow: 0 30px 60px -20px rgba(0,0,0,0.8); transform: translateY(0px) rotateY(-5deg); 
      animation: float 6s ease-in-out infinite;
    }
    @keyframes float {
      0% { transform: translateY(0px) rotateY(-5deg); }
      50% { transform: translateY(-10px) rotateY(-5deg); }
      100% { transform: translateY(0px) rotateY(-5deg); }
    }
    .promo-img { width: 100%; display: block; border-radius: 18px; }
    .promo-badge-float {
        position: absolute; top: -10px; right: -10px; background: linear-gradient(135deg, #FFC107 0%, #FF8F00 100%);
        color: #000; font-weight: 800; padding: 8px 16px; border-radius: 50px; font-size: 13px;
        box-shadow: 0 10px 20px rgba(0,0,0,0.4); transform: rotate(8deg); z-index: 2;
    }

    /* --- MENU --- */
    .section-title { 
      font-size: 22px; font-weight: 700; margin: 50px 0 24px; display: flex; align-items: center; gap: 12px; color: #fff;
      animation: fadeInUp 0.8s ease-out 0.5s backwards;
    }
    .section-title::after { content:""; height: 1px; flex: 1; background: rgba(255,255,255,0.08); }

    .cat-container {
      position: sticky; top: 75px; z-index: 40; background: #0a0a0a; margin: 0 -20px; padding: 10px 20px;
      border-bottom: 1px solid rgba(255,255,255,0.08); animation: fadeInUp 0.8s ease-out 0.7s backwards;
    }
    .search-wrapper { position: relative; margin-bottom: 12px; }
    .search-input {
      width: 100%; background: #18181b; border: 1px solid rgba(255,255,255,0.08); padding: 14px 14px 14px 48px;
      border-radius: 14px; color: #fff; font-size: 15px; transition: all 0.2s;
    }
    .search-input:focus { border-color: #FFC107; outline: none; }
    .search-icon { position: absolute; left: 18px; top: 50%; transform: translateY(-50%); color: #a1a1aa; opacity: 0.7; }

    .cat-scroll { display: flex; gap: 10px; overflow-x: auto; padding-bottom: 5px; scrollbar-width: none; }
    .cat-scroll::-webkit-scrollbar { display: none; }
    .cat-btn {
      background: #18181b; border: 1px solid rgba(255,255,255,0.08); color: #a1a1aa;
      padding: 10px 20px; border-radius: 100px; white-space: nowrap; cursor: pointer; font-weight: 600; font-size: 13px;
    }
    .cat-btn.active { background: #fff; color: #000; border-color: #fff; transform: scale(1.05); }

    /* Grid */
    .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; margin-top: 24px; }
    
    .card {
      background: rgba(30, 30, 35, 0.7); border: 1px solid rgba(255,255,255,0.08);
      border-radius: 16px; padding: 16px; transition: all 0.3s; display: flex; flex-direction: column;
      position: relative; overflow: hidden; animation: fadeInUp 0.6s ease-out backwards;
    }
    .card.disabled { opacity: 0.5; pointer-events: none; filter: grayscale(1); }

    .card-top { display: flex; gap: 16px; }
    .card-thumb {
      width: 72px; height: 72px; background: #222; border-radius: 14px; flex-shrink: 0;
      display: grid; place-items: center; font-size: 32px; border: 1px solid rgba(255,255,255,0.05);
    }
    .card-info { flex: 1; }
    .card-title { font-size: 16px; font-weight: 700; margin: 0 0 6px; color: #fff; }
    .card-desc { font-size: 13px; color: #a1a1aa; line-height: 1.4; display: -webkit-box; -webkit-line-clamp: 2; line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
    
    .card-price-row { margin-top: 16px; display: flex; justify-content: space-between; align-items: center; }
    .price { font-size: 17px; font-weight: 700; color: #FFC107; }
    
    .add-btn {
      background: rgba(255,255,255,0.05); color: #fff; width: 34px; height: 34px; border-radius: 10px;
      display: grid; place-items: center; border: 1px solid rgba(255,255,255,0.08); cursor: pointer; transition: 0.2s; font-size: 18px;
    }
    .add-btn:active { transform: scale(0.9); }

    .qty-controls { display: flex; align-items: center; gap: 10px; background: rgba(255,255,255,0.05); padding: 4px; border-radius: 10px; }
    .qty-btn { width: 26px; height: 26px; border-radius: 8px; border: none; background: #333; color: #fff; cursor: pointer; }
    .qty-val { font-weight: 700; font-size: 14px; min-width: 20px; text-align: center; }

    /* Extras & Form */
    .extras-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 30px; }
    .form-box { background: #18181b; padding: 20px; border-radius: 16px; border: 1px solid rgba(255,255,255,0.08); }
    .form-title { font-size: 15px; font-weight: 700; margin-bottom: 16px; display: flex; gap: 8px; color: #fff; }
    
    .check-item { display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px dashed rgba(255,255,255,0.1); cursor: pointer; }
    .check-left { display: flex; align-items: center; gap: 12px; }
    .custom-checkbox { width: 20px; height: 20px; border: 2px solid #a1a1aa; border-radius: 6px; display: grid; place-items: center; }
    input[type="checkbox"]:checked + .custom-checkbox { background: #FFC107; border-color: #FFC107; }
    input[type="checkbox"]:checked + .custom-checkbox::after { content:"‚úî"; font-size: 12px; color: #000; font-weight: 900; }
    input[type="checkbox"] { display: none; } 

    textarea {
      width: 100%; background: #111; border: 1px solid rgba(255,255,255,0.08);
      border-radius: 12px; padding: 14px; color: #fff; resize: vertical; min-height: 80px; font-family: inherit;
    }

    /* Cart Float */
    .cart-float {
      position: fixed; bottom: 24px; left: 50%; transform: translateX(-50%) translateY(150%);
      width: 90%; max-width: 600px; background: rgba(20, 20, 20, 0.95); backdrop-filter: blur(16px);
      border: 1px solid rgba(255,255,255,0.15); padding: 10px 10px 10px 24px; border-radius: 100px;
      display: flex; justify-content: space-between; align-items: center; box-shadow: 0 20px 50px rgba(0,0,0,0.7);
      z-index: 100; transition: transform 0.4s;
    }
    .cart-float.show { transform: translateX(-50%) translateY(0); }
    .cart-total { font-size: 16px; font-weight: 800; color: #FFC107; }
    .btn-checkout {
      background: #fff; color: #000; padding: 12px 24px; border-radius: 100px; font-weight: 700; font-size: 14px; border: none; cursor: pointer;
    }

    /* Modal */
    .modal-overlay {
      position: fixed; inset: 0; background: rgba(0,0,0,0.85); backdrop-filter: blur(8px);
      z-index: 200; display: none; place-items: center; opacity: 0; transition: opacity 0.3s;
    }
    .modal-overlay.open { opacity: 1; }
    .modal-card {
      width: 95%; max-width: 500px; max-height: 90vh; background: #121212; border: 1px solid rgba(255,255,255,0.08);
      border-radius: 24px; display: flex; flex-direction: column; transform: translateY(20px) scale(0.95); transition: all 0.3s;
    }
    .modal-overlay.open .modal-card { transform: translateY(0) scale(1); }
    .modal-header { padding: 20px 24px; border-bottom: 1px solid rgba(255,255,255,0.08); display: flex; justify-content: space-between; align-items: center; }
    .modal-body { padding: 24px; overflow-y: auto; }
    .modal-footer { padding: 20px 24px; border-top: 1px solid rgba(255,255,255,0.08); }
    .close-btn { background: rgba(255,255,255,0.05); border: none; width: 32px; height: 32px; border-radius: 50%; color: #fff; cursor: pointer; }
    .modal-input { width: 100%; background: #050505; border: 1px solid rgba(255,255,255,0.08); padding: 14px; border-radius: 12px; color: #fff; font-size: 14px; }
    .input-group { margin-bottom: 16px; }
    .input-group label { display: block; font-size: 12px; color: #a1a1aa; margin-bottom: 6px; font-weight: 600; }

    /* Footer */
    .site-footer {
      border-top: 1px solid rgba(255,255,255,0.08); padding: 40px 20px 80px; margin-top: 60px;
      text-align: center;
    }
    .footer-logo img { width: 50px; opacity: 0.8; }
    .dev-watermark { margin-top: 20px; padding-top: 20px; border-top: 1px dashed rgba(255,255,255,0.1); color: rgba(255,255,255,0.3); font-size: 11px; text-transform: uppercase; }

    /* Toast */
    #toast {
      position: fixed; bottom: 100px; left: 50%; transform: translateX(-50%) translateY(20px); opacity: 0; pointer-events: none;
      background: #10B981; color: #000; padding: 12px 24px; border-radius: 100px; font-weight: 700; font-size: 14px;
      z-index: 300; transition: all 0.4s; display: flex; align-items: center; gap: 8px;
    }
    #toast.visible { transform: translateX(-50%) translateY(0); opacity: 1; }

    /* Floating WhatsApp */
    .wa-float {
      position: fixed; bottom: 24px; right: 24px; background: #25D366; color: #fff; width: 60px; height: 60px;
      border-radius: 50%; display: grid; place-items: center; box-shadow: 0 4px 12px rgba(37, 211, 102, 0.4);
      z-index: 110; transition: transform 0.3s cubic-bezier(0.25, 0.8, 0.25, 1); text-decoration: none; animation: pulse-green 2.5s infinite;
    }
    .wa-float:hover { transform: scale(1.1); }
    .wa-float svg { width: 32px; height: 32px; fill: currentColor; }

    /* Floating Watermark */
    .watermark-float {
        position: fixed; bottom: 10px; left: 14px; z-index: 40; font-size: 10px; color: rgba(255, 255, 255, 0.2);
        font-weight: 700; letter-spacing: 1px; text-transform: uppercase; pointer-events: none; text-shadow: 0 1px 2px rgba(0,0,0,0.8);
    }

    @media (max-width: 768px) {
      .hero { grid-template-columns: 1fr; text-align: center; }
      .grid { grid-template-columns: 1fr; }
      .extras-grid { grid-template-columns: 1fr; }
      .promo-frame { transform: none !important; margin: 0 auto; }
      .wa-float { bottom: 100px; right: 16px; width: 50px; height: 50px; }
      .wa-float svg { width: 28px; height: 28px; }
    }
  </style>
</head>
<body>

  <!-- Mensagem Toast -->
  <div id="toast"><span>‚úÖ</span> Item adicionado!</div>

  <div class="topbar">
    <div class="wrap">
      <div class="brand">
        <div class="brand-icon">
          <img src="logo.jpeg" onerror="this.src='https://placehold.co/50x50/FFC107/000000?text=PF'" alt="Logo Galeteria Pais e Filhos">
        </div>
        <div class="brand-text">
          <h1>Galeteria Pais e Filhos</h1>
          <span>Premium Delivery</span>
        </div>
      </div>
      <div class="status-chip" id="statusBadge">
        <div class="status-dot"></div>
        <span id="statusText">...</span>
      </div>
    </div>
  </div>

  <div class="wrap">
    <div class="hero">
      <div class="hero-content">
        <div class="hero-badges">
          <span class="badge"><span class="fire-icon">üî•</span> Promo√ß√£o do Dia</span>
          <span class="badge">üöÄ Entrega R√°pida</span>
        </div>
        
        <div class="hours-card" style="width: 100%; text-align: left;">
          <div class="hours-row">
            <span class="hours-icon">üçó</span>
            <div class="hours-info">
              <strong>Galetos</strong>
              <span id="labelGaletoHours">S√°bados e Domingos: 09h √†s 15h</span>
            </div>
          </div>
        </div>

        <div style="display: flex; gap: 12px; margin-top: 10px;">
          <button class="btn btn-primary" onclick="window.scrollToMenu()">Fazer Pedido</button>
          <button class="btn btn-sec" onclick="window.openModal()">Ver Carrinho</button>
        </div>
      </div>
      <div class="hero-visual">
        <div class="promo-frame">
          <div class="promo-badge-float">OFERTA!</div>
          <img src="PROMO√áOES.jpeg" onerror="this.src='https://placehold.co/320x400/222/eee?text=Foto+Promocao'" alt="Promo√ß√£o Batata Frita" class="promo-img">
        </div>
      </div>
    </div>

    <div class="section-title" id="menu">Card√°pio Completo</div>

    <div class="cat-container">
      <div class="search-wrapper">
        <span class="search-icon">üîç</span>
        <input type="text" class="search-input" id="searchInput" placeholder="O que voc√™ deseja comer hoje?" oninput="window.filterMenu()">
      </div>
      <div class="cat-scroll" id="catScroll"></div>
    </div>

    <div class="grid" id="menuGrid"></div>

    <div class="extras-grid">
      <div class="form-box" id="extrasBox">
        <div class="form-title"><span>üç¥</span> Prefer√™ncias</div>
        <div id="extrasList"></div>
      </div>
      <div class="form-box">
        <div class="form-title"><span>üìù</span> Observa√ß√µes</div>
        <textarea id="obsInput" placeholder="Ex: Ponto da carne, sem cebola, troco para 50..."></textarea>
      </div>
    </div>
  </div>

  <footer class="site-footer">
    <div class="footer-content">
      <div class="footer-logo">
        <img src="logo.jpeg" onerror="this.style.display='none'" alt="Logo" style="width: 60px; height: 60px; border-radius: 50%; opacity: 0.7; filter: grayscale(1);">
      </div>
      <div class="footer-info">
        <p><strong>Galeteria Pais e Filhos</strong></p>
        <p>O melhor sabor da regi√£o entregue na sua casa.</p>
        <p style="margin-top: 10px;">üìç Atendemos Bairros Pr√≥ximos e Centro</p>
        <p>üìû (79) 98810-0417</p>
      </div>
      <div class="dev-watermark">Desenvolvido por <strong>Ferreira Web Design</strong></div>
    </div>
  </footer>

  <!-- Bot√£o Flutuante do WhatsApp -->
  <a href="https://api.whatsapp.com/message/7FGXL4XM42QXL1?autoload=1&app_absent=0&utm_source=ig&fbclid=PAVERFWAPuDqVleHRuA2FlbQExAHNydGMGYXBwX2lkDzEyNDAyNDU3NDI4NzQxNAABp8MsmdCmglIkg_LbSda7dRJqS0NV-zXyp3uoNQ7SsTCNk3_B59qMHxPSc2-j_aem_R5h8QPyU907Fseg_vmAx6Q" target="_blank" class="wa-float" aria-label="Fale conosco no WhatsApp">
    <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12.004 2c-5.514 0-10 4.486-10 10 0 1.83.496 3.567 1.373 5.09l-1.377 4.91 5.059-1.33c1.455.79 3.102 1.23 4.945 1.23 5.514 0 10-4.486 10-10s-4.486-10-10-10zm0 18.003c-1.63 0-3.125-.436-4.437-1.185l-.326-.186-2.89.76.78-2.81-.197-.332c-.84-1.423-1.33-3.08-1.33-4.85 0-4.41 3.59-8.003 8.004-8.003s8.004 3.593 8.004 8.003-3.59 8.003-8.004 8.003zm4.553-6.22c-.25-.125-1.485-.733-1.715-.817-.23-.083-.397-.125-.565.125-.168.25-.652.817-.8.984-.148.167-.298.188-.548.063-.25-.125-1.055-.39-2.01-1.24-.74-.66-1.24-1.472-1.387-1.722-.148-.25-.016-.386.11-.51.112-.112.25-.292.373-.438.125-.146.167-.25.25-.417.084-.167.042-.313-.02-.438-.063-.125-.565-1.363-.774-1.867-.203-.49-.41-.423-.565-.43-.148-.008-.317-.008-.485-.008-.168 0-.44.063-.672.313-.23.25-.882.862-.882 2.104 0 1.242.903 2.442 1.03 2.61.125.166 1.777 2.713 4.305 3.804 1.678.724 2.016.58 2.377.544.36-.037 1.148-.47 1.31-0.922.164-.452.164-.84.115-.922-.05-.084-.183-.125-.433-.25z"/></svg>
  </a>

  <!-- Marca D'√°gua Flutuante -->
  <div class="watermark-float">Ferreira Web Design</div>

  <div class="cart-float" id="cartFloat">
    <div class="cart-summ">
      <span class="cart-label">Total do Pedido</span>
      <span class="cart-total" id="floatTotal">R$ 0,00</span>
    </div>
    <div style="display:flex; gap:12px; align-items:center;">
       <button class="add-btn" style="background:transparent; border:none; color: #aaa; font-size:14px;" onclick="window.clearCart()">Limpar</button>
       <button class="btn-checkout" onclick="window.openModal()">Concluir ‚ûî</button>
    </div>
  </div>

  <!-- Modal Checkout -->
  <div class="modal-overlay" id="modalOverlay">
    <div class="modal-card">
      <div class="modal-header">
        <h3 style="margin:0; font-weight: 700;">Seu Carrinho</h3>
        <button class="close-btn" onclick="window.closeModal()">‚úï</button>
      </div>
      <div class="modal-body">
        <div id="cartItemsList"></div>
        <div style="margin-top: 24px; border-top: 1px solid var(--border); padding-top: 20px;">
           <div style="display:flex; justify-content:space-between; margin-bottom:10px; color:var(--text-sec); font-size:14px;">
             <span>Subtotal</span>
             <span id="modalSubtotal">R$ 0,00</span>
           </div>
           <div style="display:flex; justify-content:space-between; margin-bottom:10px; color:var(--text-sec); font-size:14px;">
             <span>Adicionais</span>
             <span id="modalExtras">R$ 0,00</span>
           </div>
           <div style="display:flex; justify-content:space-between; margin-bottom:16px; align-items:center;">
             <span style="color:var(--text-sec); font-size:14px;">Entrega</span>
             <select id="deliverySelect" class="modal-input" style="width: auto; padding: 8px 12px; font-size: 13px;" onchange="window.updateTotals()">
               <!-- Preenchido via JS -->
             </select>
           </div>
           <div style="display:flex; justify-content:space-between; font-size:20px; font-weight:800; color:var(--brand); border-top: 1px dashed rgba(255,255,255,0.1); padding-top: 15px;">
             <span>Total</span>
             <span id="modalTotal">R$ 0,00</span>
           </div>
        </div>
        <h4 style="margin: 24px 0 16px; font-size: 14px; text-transform: uppercase; color: var(--text-sec); letter-spacing: 0.05em; border-bottom: 1px solid var(--border); padding-bottom: 8px;">Seus Dados</h4>
        <div class="input-group"><label>Nome Completo</label><input type="text" id="clientName" class="modal-input" placeholder="Seu nome"></div>
        <div class="input-group"><label>Telefone</label><input type="tel" id="clientPhone" class="modal-input" placeholder="(XX) 9XXXX-XXXX" maxlength="15"></div>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
          <div class="input-group"><label>Pagamento</label><select id="paymentMethod" class="modal-input"><option value="Pix">Pix</option><option value="Cart√£o">Cart√£o</option><option value="Dinheiro">Dinheiro</option></select></div>
          <div class="input-group" id="changeGroup" style="display:none;"><label>Troco para</label><input type="tel" id="changeInput" class="modal-input" placeholder="R$ 0,00"></div>
        </div>

        <div id="pixGroup" style="margin-top: -8px; margin-bottom: 16px; background: rgba(255,193,7,0.1); padding: 12px; border-radius: 12px; border: 1px dashed var(--brand);">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                <span style="font-size: 11px; color: var(--brand); font-weight: 700; letter-spacing: 0.05em;">CHAVE PIX (CNPJ)</span>
                <button onclick="window.copyPix()" style="background: var(--brand); border: none; border-radius: 6px; padding: 6px 12px; font-weight: 700; cursor: pointer; font-size: 11px; color: #000; box-shadow: 0 2px 5px rgba(0,0,0,0.2);">COPIAR</button>
            </div>
            <input type="text" value="63957418000101" readonly style="width:100%; background: rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.1); color: #fff; font-family: monospace; font-size: 15px; padding: 10px; border-radius: 8px; text-align: center; margin-bottom: 8px; outline: none;" id="pixKeyInput" onclick="this.select();">
            <div style="font-size: 11px; color: var(--text-sec); text-align: center; line-height: 1.4;">Titular: <strong style="color: #fff;">Ana Paula Eloy Santana Morais</strong></div>
        </div>

        <div class="input-group"><label>Endere√ßo</label><input type="text" id="clientAddress" class="modal-input" placeholder="Rua, N√∫mero, Bairro..."></div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-primary" style="width:100%; justify-content: center; height: 50px;" onclick="window.sendOrder()">Enviar Pedido no WhatsApp</button>
      </div>
    </div>
  </div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
  import { getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
  import { getFirestore, doc, onSnapshot, setDoc, addDoc, collection, getDocs } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

  let firebaseConfig;
  let appId = 'galeteria-pais-filhos'; 

  if (typeof __firebase_config !== 'undefined') {
    firebaseConfig = JSON.parse(__firebase_config);
    if (typeof __app_id !== 'undefined') appId = __app_id;
  } else {
    firebaseConfig = {
      apiKey: "AIzaSyCzekvqmEji0fqfXrhPIQFr-xELAU8EmTs",
      authDomain: "galeto-1dc17.firebaseapp.com",
      projectId: "galeto-1dc17",
      storageBucket: "galeto-1dc17.firebasestorage.app",
      messagingSenderId: "777086839092",
      appId: "1:777086839092:web:042261c5ce1f152a4c9d61"
    };
  }

  let db, auth, user;
  
  if (firebaseConfig) {
    const app = initializeApp(firebaseConfig);
    auth = getAuth(app);
    db = getFirestore(app);

    const initAuth = async () => {
      if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
        await signInWithCustomToken(auth, __initial_auth_token);
      } else {
        await signInAnonymously(auth);
      }
    };
    initAuth();

    onAuthStateChanged(auth, (u) => {
      user = u;
      if (user) {
        subscribeToConfig(); 
      }
    });
  } else {
    loadConfigLocal();
  }

  const WHATSAPP = "5579988100417";
  const APPS_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyXPG30IQSfBWDxaHh_7m5Z_ZYnuFcoWNqzv-WqePbtBjSPQkh3Y5wyEgwOpcDbALkqkw/exec"; 

  let appConfig = {
    isOpenManually: true, 
    deliveryZones: [
        { name: "Retirada", price: 0 },
        { name: "Albano Franco", price: 2.00 },
        { name: "Marcos Freire 1", price: 3.00 },
        { name: "Marcos Freire 3", price: 3.00 },
        { name: "Tai√ßoca de Dentro", price: 3.00 },
        { name: "Maria do Carmo", price: 4.00 },
        { name: "Novo Horizonte", price: 4.00 },
        { name: "Marcos Freire 2", price: 4.00 },
        { name: "Piabeta", price: 5.00 },
        { name: "Jo√£o Alves", price: 5.00 },
        { name: "Porto D'antas", price: 5.00 },
        { name: "Neuzice Barreto", price: 5.00 },
        { name: "Tai√ßoca de Fora", price: 5.00 },
        { name: "Fernando Collor", price: 6.00 },
        { name: "Bairro Industrial", price: 6.00 },
        { name: "Jap√£ozinho", price: 7.00 },
        { name: "Lamar√£o", price: 7.00 },
        { name: "Cidade Nova", price: 8.00 },
        { name: "Sede de Socorro", price: 10.00 }
    ],
    hours: { galeto: { start: 9, end: 15 } },
    stock: {}
  };

  const categories = [
    { id: "todos", label: "Todos" },
    { id: "combos", label: "Combos" },
    { id: "porcoes", label: "Por√ß√µes" },
    { id: "bebidas", label: "Bebidas" }
  ];

  const products = [
    { id: 10, cat: "combos", name: "Combo 1 (Inteiro)", desc: "Batatas e Farofa", price: 45.00, img: "üçó" },
    { id: 11, cat: "combos", name: "Combo 1 (Metade)", desc: "Batatas e Farofa", price: 25.00, img: "üçó" },
    { id: 20, cat: "combos", name: "Combo 2 (Inteiro)", desc: "Batatas, Farofa, Arroz, Feij√£o Tropeiro e Vinagrete (Serve 2 Pessoas)", price: 55.00, img: "üçõ" },
    { id: 21, cat: "combos", name: "Combo 2 (Metade)", desc: "Batatas, Farofa, Arroz, Feij√£o Tropeiro e Vinagrete", price: 32.00, img: "üçõ" },
    { id: 30, cat: "combos", name: "Combo Fam√≠lia", desc: "Batatas, Farofa, Arroz, Feij√£o Tropeiro e Vinagrete (Serve at√© 6 Pessoas)", price: 75.00, img: "üë®‚Äçüë©‚Äçüëß‚Äçüë¶" },
    { id: 5, cat: "porcoes", name: "Batata Frita (M)", desc: "Por√ß√£o M√©dia", price: 13.00, img: "üçü" },
    { id: 51, cat: "porcoes", name: "Batata Frita (G)", desc: "Por√ß√£o Grande", price: 16.00, img: "üçü" },
    { id: 40, cat: "porcoes", name: "Arroz", desc: "Por√ß√£o", price: 7.00, img: "üçö" },
    { id: 41, cat: "porcoes", name: "Vinagrete", desc: "Por√ß√£o", price: 5.00, img: "ü•ó" },
    { id: 42, cat: "porcoes", name: "Feij√£o Tropeiro", desc: "Por√ß√£o", price: 8.00, img: "üç≤" },
    { id: 7, cat: "bebidas", name: "Coca-Cola 2L", desc: "Bem gelada", price: 13.00, img: "ü•§" },
    { id: 71, cat: "bebidas", name: "Coca-Cola 1L", desc: "Bem gelada", price: 8.00, img: "ü•§" }
  ];

  const extras = [];

  let cart = {}; 
  let selectedExtras = new Set();
  let activeCat = "todos";

  window.add = add;
  window.rem = rem;
  window.setCat = setCat;
  window.filterMenu = filterMenu;
  window.toggleExtra = toggleExtra;
  window.clearCart = clearCart;
  window.openModal = openModal;
  window.closeModal = closeModal;
  window.updateTotals = updateTotals;
  window.scrollToMenu = scrollToMenu;
  window.sendOrder = sendOrder;
  window.copyPix = copyPix;

  function formatMoney(v) { 
      if(v === null || v === undefined || isNaN(v)) return "R$ 0,00";
      return "R$ " + parseFloat(v).toFixed(2).replace('.', ','); 
  }

  function copyPix() {
      const input = document.getElementById('pixKeyInput');
      input.select();
      input.setSelectionRange(0, 99999);
      document.execCommand('copy');
      const t = document.getElementById('toast');
      t.innerHTML = "<span>üìã</span> Chave Pix copiada!";
      t.classList.add('visible'); setTimeout(() => t.classList.remove('visible'), 2000);
  }

  // --- EXPLOS√ÉO DE EMOJIS ---
  function explodeEmojis(x, y) {
      if (!x || !y) {
          x = window.innerWidth / 2;
          y = window.innerHeight / 2;
      }
      const emojis = ['üçó', 'üçü', 'ü•§', 'üòã', 'üî•', 'üß°', '‚ú®', 'üáßüá∑'];
      const count = 12;
      for (let i = 0; i < count; i++) {
        const el = document.createElement('div');
        el.className = 'emoji-particle';
        el.innerText = emojis[Math.floor(Math.random() * emojis.length)];
        el.style.left = x + 'px';
        el.style.top = y + 'px';
        const angle = Math.random() * Math.PI * 2;
        const velocity = 60 + Math.random() * 80;
        const tx = Math.cos(angle) * velocity + 'px';
        const ty = Math.sin(angle) * velocity + 'px';
        const rot = (Math.random() * 360 - 180) + 'deg';
        el.style.setProperty('--tx', tx);
        el.style.setProperty('--ty', ty);
        el.style.setProperty('--rot', rot);
        document.body.appendChild(el);
        setTimeout(() => el.remove(), 1000);
      }
  }

  const phoneInput = document.getElementById('clientPhone');
  if(phoneInput) {
    phoneInput.addEventListener('input', function (e) {
      let x = e.target.value.replace(/\D/g, '').match(/(\d{0,2})(\d{0,5})(\d{0,4})/);
      e.target.value = !x[2] ? x[1] : '(' + x[1] + ') ' + x[2] + (x[3] ? '-' + x[3] : '');
    });
  }

  function subscribeToConfig() {
    if (!db || !user) return;
    const docRef = doc(db, 'artifacts', appId, 'public', 'data', 'config', 'store_settings');
    onSnapshot(docRef, (docSnap) => {
      if (docSnap.exists()) {
        const remoteConfig = docSnap.data();
        appConfig = { 
            ...appConfig, 
            ...remoteConfig,
            stock: { ...appConfig.stock, ...(remoteConfig.stock || {}) },
            hours: { ...appConfig.hours, ...(remoteConfig.hours || {}) }
        };
        if(remoteConfig.deliveryZones) appConfig.deliveryZones = remoteConfig.deliveryZones;
        renderMenu();
        updateDeliveryOptions();
        checkOpenStatus();
      }
    });
  }

  // --- BUSCAR N√öMERO GLOBAL ---
  async function getNextOrderNumber() {
      // Timeout de 2.5s para n√£o travar muito tempo
      const timeout = new Promise((_, reject) => 
          setTimeout(() => reject(new Error("Timeout")), 2500)
      );

      const fetchOrder = async () => {
          if (!db || !user) throw new Error("Sem conex√£o DB");
          const colRef = collection(db, 'artifacts', appId, 'public', 'data', 'orders');
          const snapshot = await getDocs(colRef);
          return (snapshot.size + 1).toString().padStart(2, '0');
      };

      try {
          // Tenta pegar o global. Se demorar, usa local.
          return await Promise.race([fetchOrder(), timeout]);
      } catch (e) {
          console.log("Usando numera√ß√£o local/fallback:", e);
          let localCount = parseInt(localStorage.getItem('localOrderCount') || '0') + 1;
          localStorage.setItem('localOrderCount', localCount);
          return localCount.toString().padStart(2, '0');
      }
  }

  async function saveOrderToFirebase(orderData) {
    if (!db || !user) return;
    try {
      const colRef = collection(db, 'artifacts', appId, 'public', 'data', 'orders');
      await addDoc(colRef, { ...orderData, timestamp: new Date() });
    } catch (e) { console.error("Erro Firebase:", e); }
  }

  function loadConfigLocal() {
    const saved = localStorage.getItem('galeteriaConfig');
    if (saved) {
      const parsed = JSON.parse(saved);
      appConfig = { ...appConfig, ...parsed };
    }
    products.forEach(p => { if (appConfig.stock[p.id] === undefined) appConfig.stock[p.id] = true; });
    renderMenu();
    updateDeliveryOptions();
    checkOpenStatus();
  }

  function checkOpenStatus() {
    const now = new Date();
    const day = now.getDay();
    const hour = now.getHours();
    let statusText = "Fechado";
    let statusClass = "closed";
    const isWeekend = (day === 0 || day === 6); 
    const galetoOpen = isWeekend && (hour >= appConfig.hours.galeto.start && hour < appConfig.hours.galeto.end);

    if (appConfig.isOpenManually) {
        statusText = "Aberto"; statusClass = "open";
    } else {
        statusText = "Fechado"; statusClass = "closed";
    }

    const badge = document.getElementById('statusBadge');
    if(badge) {
        badge.className = `status-chip ${statusClass}`;
        document.getElementById('statusText').textContent = statusText;
    }
    document.getElementById('labelGaletoHours').textContent = `S√°bados e Domingos: ${appConfig.hours.galeto.start}h √†s ${appConfig.hours.galeto.end}h`;
  }

  function updateDeliveryOptions() {
    const sel = document.getElementById('deliverySelect');
    let optionsHtml = '';
    if (appConfig.deliveryZones && appConfig.deliveryZones.length > 0) {
        optionsHtml = appConfig.deliveryZones.map(z => 
            `<option value="${z.price}">${z.name} (${z.price === 0 ? 'Gr√°tis' : formatMoney(z.price)})</option>`
        ).join('');
    }
    sel.innerHTML = optionsHtml;
  }

  function renderCategories() {
    const el = document.getElementById('catScroll');
    el.innerHTML = categories.map(c => 
      `<button class="cat-btn ${c.id === activeCat ? 'active' : ''}" onclick="window.setCat('${c.id}')">${c.label}</button>`
    ).join('');
  }

  function renderMenu() {
    const grid = document.getElementById('menuGrid');
    const search = document.getElementById('searchInput').value.toLowerCase();
    const filtered = products.filter(p => {
      const matchCat = activeCat === 'todos' || p.cat === activeCat;
      const matchSearch = p.name.toLowerCase().includes(search) || p.desc.toLowerCase().includes(search);
      return matchCat && matchSearch;
    });

    grid.innerHTML = filtered.map((p, index) => {
      const qty = cart[p.id] || 0;
      const inStock = appConfig.stock[p.id] !== false; 
      
      return `
      <div class="card ${!inStock ? 'disabled' : ''}" style="animation-delay: ${index * 0.05}s">
        <div class="card-top">
          <div class="card-thumb">${p.img}</div>
          <div class="card-info">
            <h3 class="card-title">${p.name}</h3>
            <div class="card-rating">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ <span style="color:#a1a1aa; font-size:10px">(120)</span></div>
            <p class="card-desc">${inStock ? p.desc : '‚ùå INDISPON√çVEL'}</p>
          </div>
        </div>
        <div class="card-price-row">
          <div class="price">${formatMoney(p.price)}</div>
          ${!inStock ? '' : (qty === 0 ? 
            `<button class="add-btn" onclick="window.add('${p.id}', event)">+</button>` :
            `<div class="qty-controls">
               <button class="qty-btn" onclick="window.rem('${p.id}')">-</button>
               <span class="qty-val">${qty}</span>
               <button class="qty-btn" onclick="window.add('${p.id}', event)">+</button>
             </div>`
          )}
        </div>
      </div>
      `;
    }).join('');
  }

  function setCat(id) { activeCat = id; renderCategories(); renderMenu(); }
  function filterMenu() { renderMenu(); }

  function add(id, event) {
    id = parseInt(id);
    cart[id] = (cart[id] || 0) + 1;
    
    // Call explosion
    if(event) explodeEmojis(event.clientX, event.clientY);

    renderMenu(); updateCartUI();
    const t = document.getElementById('toast');
    t.innerHTML = "<span>‚úÖ</span> Item adicionado!";
    t.classList.add('visible'); setTimeout(() => t.classList.remove('visible'), 2000);
  }
  function rem(id) {
    id = parseInt(id);
    if (cart[id] > 0) { cart[id]--; if (cart[id] === 0) delete cart[id]; }
    renderMenu(); updateCartUI();
  }
  function toggleExtra(id, checked) {
    if (checked) selectedExtras.add(id); else selectedExtras.delete(id);
    updateCartUI();
  }
  function clearCart() {
    cart = {}; selectedExtras.clear(); document.getElementById('obsInput').value = "";
    renderMenu(); updateCartUI();
  }

  function getCartTotal() {
    let total = 0;
    for (const [id, qty] of Object.entries(cart)) {
      const p = products.find(x => x.id == id);
      if (p) total += p.price * qty;
    }
    return total;
  }
  function getExtrasTotal() {
    let total = 0;
    selectedExtras.forEach(eid => {
      const ex = extras.find(x => x.id === eid);
      if (ex) total += ex.price;
    });
    return total;
  }

  function updateCartUI() {
    const prodTotal = getCartTotal();
    const extraTotal = getExtrasTotal();
    const subtotal = prodTotal + extraTotal;
    const delivery = parseFloat(document.getElementById('deliverySelect').value) || 0;
    
    document.getElementById('floatTotal').innerText = formatMoney(subtotal);
    const float = document.getElementById('cartFloat');
    if (subtotal > 0) float.classList.add('show'); else float.classList.remove('show');

    document.getElementById('modalSubtotal').innerText = formatMoney(prodTotal);
    document.getElementById('modalExtras').innerText = formatMoney(extraTotal);
    document.getElementById('modalTotal').innerText = formatMoney(subtotal + delivery);
    renderCartItems();
  }

  function renderCartItems() {
    const list = document.getElementById('cartItemsList');
    let html = '';
    if (Object.keys(cart).length === 0) {
      list.innerHTML = `<div style="text-align:center; padding:40px 20px; color:#a1a1aa"><p>Carrinho vazio.</p></div>`;
      return;
    }
    for (const [id, qty] of Object.entries(cart)) {
      const p = products.find(x => x.id == id);
      html += `
        <div class="cart-item">
          <div style="font-size:24px;">${p.img}</div>
          <div style="flex:1;">
            <div style="font-weight:600;">${p.name}</div>
            <div style="font-size:12px; color:#a1a1aa;">${qty}x ${formatMoney(p.price)}</div>
          </div>
          <div style="font-weight:700;">${formatMoney(p.price * qty)}</div>
        </div>
      `;
    }
    list.innerHTML = html;
  }

  function updateTotals() { updateCartUI(); }

  function openModal() {
    const overlay = document.getElementById('modalOverlay');
    overlay.style.display = 'flex'; setTimeout(() => overlay.classList.add('open'), 10);
    renderCartItems(); 
  }
  function closeModal() {
    const overlay = document.getElementById('modalOverlay');
    overlay.classList.remove('open'); setTimeout(() => overlay.style.display = 'none', 300);
  }
  function scrollToMenu() { document.getElementById('menu').scrollIntoView({ behavior: 'smooth' }); }

  document.getElementById('paymentMethod').addEventListener('change', function(e) {
    const changeGrp = document.getElementById('changeGroup');
    const pixGrp = document.getElementById('pixGroup');
    if (e.target.value === 'Dinheiro') {
        changeGrp.style.display = 'block'; pixGrp.style.display = 'none';
    } else if (e.target.value === 'Pix') {
        changeGrp.style.display = 'none'; pixGrp.style.display = 'block';
    } else {
        changeGrp.style.display = 'none'; pixGrp.style.display = 'none';
    }
  });

  async function sendOrder() {
    if (!appConfig.isOpenManually) {
        alert("üîí LOJA FECHADA\nEstamos fechados no momento. Hor√°rio: S√°b e Dom (09h-15h).");
        return; 
    }

    const name = document.getElementById('clientName').value;
    const phone = document.getElementById('clientPhone').value;
    const address = document.getElementById('clientAddress').value;
    const payment = document.getElementById('paymentMethod').value;
    const change = document.getElementById('changeInput').value;
    const deliverySelect = document.getElementById('deliverySelect');
    const deliveryVal = parseFloat(deliverySelect.value);
    const deliveryText = deliverySelect.options[deliverySelect.selectedIndex].text;
    const obs = document.getElementById('obsInput').value;

    if (Object.keys(cart).length === 0) { alert("Carrinho vazio!"); return; }
    if (!name || !phone) { alert("Preencha nome e telefone."); return; }
    if (deliveryVal > 0 && !address) { alert("Preencha o endere√ßo."); return; }

    const btn = document.querySelector('.modal-footer .btn-primary');
    const originalText = btn.innerText;
    btn.innerText = "Gerando Pedido..."; // Feedback melhor
    btn.disabled = true;

    // --- GERAR N√öMERO GLOBAL ---
    let orderNum = "??";
    try {
        orderNum = await getNextOrderNumber();
    } catch(e) {
        // Fallback j√° tratado na fun√ß√£o, mas seguran√ßa extra
        orderNum = "OFF"; 
    }

    // --- MONTAR MENSAGEM SUPER REDUZIDA ---
    let msg = `*PEDIDO ${orderNum}*\n\n`; // Sem nome da loja, sem #

    // ITENS (S√≥ quantidade e nome)
    for (const [id, qty] of Object.entries(cart)) {
      const p = products.find(x => x.id == id);
      if(p) msg += `${qty}x ${p.name}\n`;
    }
    
    // EXTRAS
    if (selectedExtras.size > 0) {
      msg += `+ `;
      selectedExtras.forEach(eid => msg += `${extras.find(x=>x.id===eid).name}, `);
      msg = msg.slice(0, -2); // Remove ultima virgula
      msg += `\n`;
    }

    msg += `\n`; // Pula linha

    // ENDERE√áO (Direto: Rua - Bairro)
    if (deliveryVal > 0) {
        // Pega s√≥ o nome do bairro, remove "(R$ ...)"
        let bairroLimpo = deliveryText.split('(')[0].trim();
        msg += `${address} - ${bairroLimpo}\n`; 
    } else {
        msg += `Retirada no Local\n`;
    }

    msg += `\n`; // Pula linha

    // PAGAMENTO E TOTAL
    // Ex: Pix R$ 58,00
    // Ex: Dinheiro R$ 58,00 (Troco: 10)
    
    const total = getCartTotal() + getExtrasTotal() + deliveryVal;
    
    let infoPag = `${payment} ${formatMoney(total)}`;
    if (payment === 'Dinheiro' && change) infoPag += ` (Troco: ${change})`;
    
    msg += `${infoPag}\n`;

    // CLIENTE (No final, bem discreto)
    msg += `\n${name} - ${phone}`;
    
    if (obs) msg += `\n(${obs})`;

    // OPEN WHATSAPP IMMEDIATELY
    const waLink = `https://wa.me/${WHATSAPP}?text=${encodeURIComponent(msg)}`;
    window.open(waLink, '_blank');

    // SAVE BACKGROUND (Dados completos para o banco)
    let pagamentoTexto = `${payment} ${formatMoney(total)}`;
    if (payment === 'Dinheiro' && change) pagamentoTexto += ` (Troco: ${change})`;
    
    // Lista de itens completa para o banco
    let itemsListFull = "";
    for (const [id, qty] of Object.entries(cart)) {
      const p = products.find(x => x.id == id);
      if(p) itemsListFull += `${qty}x ${p.name}, `;
    }

    const orderData = {
        numero: orderNum,
        data: new Date().toLocaleString('pt-BR'),
        cliente: name, telefone: phone, valor: total, pagamento: pagamentoTexto,
        endereco: address || "Retirada", bairro: deliveryText, detalhes: itemsListFull, entrega: deliveryVal
    };

    saveOrderToFirebase(orderData);
    if (APPS_SCRIPT_URL) {
        fetch(APPS_SCRIPT_URL, {
            method: 'POST', mode: 'no-cors', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(orderData)
        }).catch(e => console.log(e));
    }

    setTimeout(() => {
        btn.innerText = originalText; btn.disabled = false;
        window.closeModal(); window.clearCart();
    }, 1000);
  }

  // Initial render
  renderCategories();
  renderMenu();
  updateDeliveryOptions();
  checkOpenStatus();

  document.getElementById('modalOverlay').addEventListener('click', (e) => { if (e.target.id === 'modalOverlay') closeModal(); });
</script>
</body>
</html>
